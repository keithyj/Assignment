---
output: pdf_document
urlcolor: blue
fontsize: 11pt
geometry: margin = 1in
fig_caption: yes
header-includes: 
- \usepackage{graphicx}
- \usepackage{float}
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(
	fig.align = "center",
	fig.width = 7,
	message = FALSE,
	include = TRUE,
	warnings = FALSE,
	fig.pos='H'
)
```

``` {r load, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
load("cancer.rdata")
library(VIM)
library(GGally)
library(usmap)
library(car)
library(stringr)
library(knitr)
library(tidyr)  
```

## Checking the summary and initial EDA

There are some missing values in PctEmployed16_Over which need to be checked.

The minimum value in AvgHouseholdSize is very small which is suspicious and should be immediately investigated.

From the above plot we note that there are many extremely suspicious points with small AvgHouseholdSize.

We identify one of these points and investigate it:

```{r Extracting suspicious point, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
kable(subset(cancer, AvgHouseholdSize < 0.5)[1,c("Geography", "AvgHouseholdSize")], align = "l")
```

To check the validity of this data point we find an alternate source of the data at:

https://data.census.gov/cedsci/table?q=average%20household%20size&g=0500000US54003&y=2013&tid=ACSST1Y2013.S1101

We note that this data recording AvgHouseholdSize in the same year as our data lists the size at 2.61. This is completely different and this is similar for other small values in our dataset.

Hence, these are very likely incorrectly inputted data points and as there is only a small proportion of them we should treat them as missing data and then test to see whether they are MCAR.

```{r Replace small with NA, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
cancer1 <- cancer
cancer1$AvgHouseholdSize[which(cancer1$AvgHouseholdSize < 0.5)] <- NA
```

## Missing values check

Now that we have replaced the small values with NAs we can test the data to see what kind of missing values we have.

```{r Miss, fig.cap = "\\label{fig:figs}Pbox plots showing difference between missing and non-missing data", results = "asis", fig.height = 3, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
par(mfrow = c(1,4))
for (i in c(2,3,8, 18)){ 
  pbox(cancer1,pos=i) 
}
```

We use the pbox() function from the VIM package to check what these missing values represent.

From the above plots we note that the box plots with the missing data do not look significantly different from those without. The pbox plots for the other variables look similar to this so we conclude that the data that is missing is MCAR.

With our data we could replace all the data with an alternate source but as the proportion of missing data points is so small and it is MCAR it is safe to just remove the rows with missing data from our data set.

```{r remove miss, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
cancer2 <- na.omit(cancer1)
```


```{r, echo = FALSE, fig.cap = "A large plot containing densities, bivariate plots and correlations", eval = FALSE}
mod_points=function(data,mapping,...) {
  ggally_smooth_loess(data, mapping,pch=20, ...) +
    theme(text = element_text(size=8))
}  
mod_cor=function(data,mapping,...) {
  ggally_cor(data, mapping,size=1.5,align_percent=0.9, digits = 2) + scale_colour_manual(values = c("red", "blue")) + theme(panel.grid.major = element_blank(),...)
}
ggpairs(cancer2, columns = c(2:3, 5:18), mapping = aes(alpha = 0.6),
        upper = list(continuous=mod_cor),
        lower = list(continuous=wrap(mod_points, col = "red")),
        diag = list(continuous="densityDiag"),
        progress = FALSE) +
        theme(text=element_text(size=6))
```


## Analysis of deathRate

Our assignment brief tells us we should investigate deathRate as a repsonse variable when it comes to our investigation. So we first make sure that a normal linear model is appropriate by making sure that deathRate is normally distributed. From deathRate's density and QQ Plots we can see that the variable deathRate is normally distributed so a normal linear model is appropriate to use. 

```{r qqnorm and density, fig.asp = 0.4, echo = FALSE}
par(mfrow = c(1,2))
plot(density(cancer2$deathRate), main = "Density Plot of deathRate")
qqnorm(cancer2$deathRate, main = "QQ Plot of deathRate")
qqline(cancer2$deathRate, col = "red")
```

## Histograms

```{r histograms included, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE, fig.asp = 0.3}

par(mfrow = c(1,4))
hist(cancer2$medIncome, breaks = 30, main = "Median Income", ylab = "Frequency", xlab = "medIncome") # Keep
hist(cancer2$incidenceRate, breaks = 30, main = "Incidence Rate", ylab = "Frequency", xlab = "incidenceRate") # Keep
hist(cancer2$AvgHouseholdSize, breaks = 30, main = "Average Household Size", ylab = "Frequency", xlab = "AvgHouseholdSize") # Keep
hist(cancer2$PctBlack, breaks = 30, main = "Percentage of Population that is Black", ylab = "Frequency", xlab = "PctBlack") # Keep
```

#### Analysis on PctBlack, MedIncome, AverageHousehold, Incidence Rate

Massive right skew for pctBlack. PctUnemployed and AvgHouseholdSize are also a little right skew.
I Recommend a log transform for pctBlack and sqrt transforms for pct unemployed and avg household size.
Massive right skew for medIncome. Median age Male and Female seem to have a pretty symettrical skew.
I recommend a log transform for medIncome.

From the histograms, PctPrivateCoverage is slightly left skewed and povertyPercent
is right skewed.
Transformations are needed.
Try cube root for povertyPercent.

```{r Transformsinclude, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE, fig.asp = 0.3}
par(mfrow = c(1,4))
hist(log(cancer2$medIncome), breaks = 30, main = "Transformed medIncome", ylab = "Frequency", xlab = "log(medIncome)")
hist(sqrt(cancer2$AvgHouseholdSize), breaks = 30, main = "Transformed AvgHouseholdSize", ylab = "Frequency", xlab = "sqrt(AvgHouseholdSize)")
hist(cancer2$povertyPercent^(1/3), breaks = 30, main = "Histogram of cube root of povertyPercent", ylab = "Frequency", xlab = "povertyPercent^(1/3)")
hist(log(cancer2$PctBlack), breaks = 30, main = "Transformed PctBlack", ylab = "Frequency", xlab = "log(PctBlack)")
```

#### Analysis of Transformed Histograms
There still exists a slight right skew for medIncome but it is an improvement.

The skewness in povertyPercent is removed in the cubeth rooting transfomation.

The skewness is in PctPrivateCoverage is removed by the square transformation.


## Bivariate Plots
### Plots Against Death Rate
```{r Plots against deathRate, fig.cap = "\\label{fig:figs}Plots showing deathRate against other variables", fig.width=7, fig.asp=0.3, fig.align="center", echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
par(mfrow = c(1,3))
with(cancer2, scatter.smooth(deathRate~PctBlack, col = "red"), ylab="deathRate", xlab="PctBlack") # keep
scatter.smooth(cancer2$incidenceRate, cancer2$deathRate, lpars=list(col = "blue", lwd = 2), ylab="deathRate",xlab="Incidence Rate") # Keep
scatter.smooth(cancer2$medIncome, cancer2$deathRate, lpars=list(col = "blue", lwd = 2), ylab="deathRate", xlab="Median Income") # Keep
```

Most predictor variables in US cancer dataset show signs of linearity and no heteroscedasticity. 

However, from the bivariate plots above, we can observe definite heteroscedasticity in pctBlack, Incidence Rate and medIncome. We might need to perform further investigation after fitting a model and we can use spreadLevelPlot() to find an appropriate power transformation to fix heteroscedasticity. We were also able to observe that the outliers of incidence rate might have a high influence underlying its heteroscedasticity and non-linearity. 

Moreover, we can see non-linearity in AvgHouseholdsize,MedianAgeFemale and MedianAgeMale (See Appendix). We notice a concave shape for incidence rate and AvgHouseholdsize so we advise having a more compex model, perhaps with a quadratic term might be improve linearity as the data is not monotonic. We could also consider combining MedianAgeFemale and MedianAgeMale by taking an average as their relationship with Death Rate are very similar. 

### Plots for Outliers
```{r BoxPlots, fig.cap = "\\label{fig:figs}BoxPlots of our variables", fig.align="center", echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE, fig.asp = 0.45}
par(mfrow = c(2,3))
with(cancer2, boxplot(PctUnemployed16_Over, main = "PctUnemployed16_Over")) #Keep
with(cancer2, boxplot(PctBlack, main = "PctBlack")) # Keep
with(cancer2, boxplot(deathRate, main = "deathRate")) # Keep
with(cancer2, boxplot(medIncome, main = "medIncome")) # Keep
with(cancer2, boxplot(incidenceRate, main = "incidenceRate")) # Keep
with(cancer2, boxplot(povertyPercent, main = "povertyPercent")) # Keep
```

Our box plots (Figure 6 and see Appendix) show that we have quite a number of what we would consider outliers across all our variables apart from binnedInc, which would be impossible due to the bins intervals. 
We have a severe amount of outliers in medIncome. This is most likely due to natural causes such as a CEO of a large company or a doctor (see Reference about high paid jobs #James). 
We also observe significant outliers in PctBlack and this is illustrated by the very long tail as shown in the histogram above (See Fig. ). This might be due to PctBlack being an unstable predictor variable. We observe significantly high percentages of over 50% in  south and southeast region of the US, in particular, in Mississippi, Georgia, Alabama and North and South Carolina. They indeed form part of the top 10 US state with the highest percentage of Black residents. (see Reference about Black population in US)

The boxplot for Incidence rate shows the existence of extreme high values which is also illustrated in our bivariate plots in Fig . There are potential outliers in PctPrivateCoverage and povertyPercent.We might want to further investigate into these and decide how we might want to treat them before fitting the model. Possible options might include deleting the outliers or imputing them. 

We suggest that the incidence rate in Williamsburg city, Virginia can be considered as a candidate for removal. (See reference graph for Williamsburg city, Virginia)

### Multicollinearity
We can see that there is potential multicollinearity between: PercentMarried and PctMarried Households (correlation 0.87), PctUnemployed16_over and PctEmployed16_Over (correlation -0.65), MedianAgeFemale and MedianAgeMale (Correlation 0.94). (See Appendix)
We further used Pearson correlation test (see Appendix) to check for multicollinearity between percentPoverty and PctEmployed_Over16 (-0.74), PctPrivateCoverage (-0.82), PctEmpPrivCoverage (-0.68), and PctPublicCoverage(0.65).Therefore, we might consider discarding some of the predictor variables due to high multicollinearity to improve accuracy when fitting a model.

\scriptsize

```{r cor, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
round(cor(cancer2[,c(5,10:14)])[1,], digits = 2)
``` 

\normalsize

We can observe that for the first 9 bins medIncome and binnedInc show very similar results. We will therefore consider only using medIncome in our model.











